---
title: 'ğŸ¤– ê°„ë‹¨í•œ Telegram Bot ë§Œë“¤ì–´ë³´ê¸°'
date: 2020-5-12 00:31:18
category: 'Python'
draft: false
---   

## Intro
ëŒ€ë¶€ë¶„ì˜  ì·¨ì¤€ìƒë“¤ì€  ëˆì´  ë¶€ì¡±í•˜ë‹¤. ê³ ì •ì ì¸  ì•Œë°”ë¥¼  í•   ìˆ˜  ìˆì§€ë§Œ  ê·¸ë ‡ê²Œ  í•˜ê¸°ëŠ” ì‹œê°„ì ìœ¼ë¡œ  ë¶€ë‹´ì´  ë˜ì„œ  ë‹¨ê¸°  ì•Œë°”ë¥¼  ì°¾ê²Œ ëœë‹¤. ëŒ€ì „  ì§€ì—­ì—ëŠ”  í•  ë§Œí•œ ë‹¨ê¸°  ì•Œë°”  ê³µê³ ê°€  ë§ì´  ì—†ê³ , ê´œì°®ì€ ê³µê³ ê°€  ì˜¬ë¼ì˜¤ë©´  ë§ì€  ì‚¬ëŒë“¤ì´  ì§€ì›í•˜ê¸°  ë•Œë¬¸ì—  ì„ ì°©ìˆœìœ¼ë¡œ  ë§ˆê°  í›„  ë‚´ë¦¬ëŠ”  ê²½ìš°ê°€  ë§ë‹¤. ì¦‰, ë¹¨ë¦¬ ì§€ì›í•˜ëŠ” ì‚¬ëŒì´  ì•Œë°”ë¥¼  í•  ìˆ˜ ìˆëŠ” í™•ë¥ ì´  ë†’ë‹¤. ì–´í”Œì—  ë§ì¶¤ì•Œë°”  ì•Œë¦¼  ê¸°ëŠ¥ì´  ìˆì§€ë§Œ  ì•Œë¦¼ì´  ì œëŒ€ë¡œ  ì˜¤ì§€  ì•Šì•„ì„œ  ì‚¬ì´íŠ¸ë¥¼  ìˆ˜ì‹œë¡œ  í™•ì¸ì„  í•´ì•¼í•˜ëŠ”  ë²ˆê±°ë¡œì›€ì´  ìˆì—ˆë‹¤. ì•Œë°” êµ¬ì§ ì‚¬ì´íŠ¸ëŠ” í¬ê²Œ ì•Œë°”ì²œêµ­ê³¼ ì•Œë°”ëª¬ì´ ìˆëŠ”ë° í™•ì¸í•´ ë³¸ ê²°ê³¼ ì•Œë°”ëª¬ì´ í™•ì‹¤íˆ ì´ìš©ë¥ ì´ ë†’ë‹¤. ê·¸ë˜ì„œ  ì•Œë°”ëª¬  ì‚¬ì´íŠ¸ì—  ë‹¨ê¸°  ì•Œë°”  ê³µê³ ê°€  ì˜¬ë¼ì˜¤ë©´  ì•Œë¦¼  ë©”ì„¸ì§€ë¥¼  ë³´ë‚´ì£¼ëŠ”  ìƒˆ  ê¸€  ì•Œë¦¼  í…”ë ˆê·¸ë¨  ë´‡ì„  ë§Œë“¤ì–´  ë³´ì•˜ë‹¤. 

## Process
### í…”ë ˆê·¸ë¨ ë´‡ ìƒì„±
í…”ë ˆê·¸ë¨ ì„¤ì¹˜ í›„ *BotFather* ë¥¼ ê²€ìƒ‰í•˜ì—¬ ì¶”ê°€í•œë‹¤.   
ì±„íŒ…ì°½ì— */newbot* ì„ ì…ë ¥ í›„ ë´‡ì˜ ì´ë¦„ì„ ì •í•´ì¤€ë‹¤.   
ì´ ë©”ì„¸ì§€ë¥¼ ë°›ì•˜ë‹¤ë©´ ì •ìƒì ìœ¼ë¡œ ë´‡ì´ ìƒì„±ì´ ëœ ê²ƒì´ë‹¤.   

![bot](images/2020-1/01.png)   
  

ë‹¤ì‹œ  ìƒì„±í•œ  ë´‡ì˜ ì´ë¦„ì„  ê²€ìƒ‰í•˜ê³  ì¶”ê°€í•˜ì—¬ */start* ë¥¼  ì…ë ¥í•œë‹¤.   
ê·¸ë¦¬ê³  í…ŒìŠ¤íŠ¸ë¡œ ë©”ì„¸ì§€ë¥¼ í•˜ë‚˜ ë³´ë‚´ë†“ëŠ”ë‹¤.   
```python
bot = telegram.Bot(token='Use this token to access the HTTP API')

for i in bot.getUpdates():
    print(i.message)
```
ê²°ê³¼ì—ì„œ 'chat': {'id': **1234567890**, â€¦} ì´ ë¶€ë¶„ì˜ ìˆ«ìë¥¼ chat_idì— ì…ë ¥í•œë‹¤.

```python
bot.sendMessage(chat_id=1234567890, text="í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.")
```    

ë´‡ì—ê²Œ  *"í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤."* ë©”ì„¸ì§€ë¥¼  ë°›ìœ¼ë©´  í…”ë ˆê·¸ë¨ ë´‡ ì„¸íŒ…ì€ ëì´ë‹¤.   

### ì›¹ í¬ë¡¤ë§
ì›¹ í¬ë¡¤ë§ì—ì„œ ì¤‘ìš”í•œ ê²ƒì€ ì›í•˜ëŠ” ì •ë³´ë§Œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ë‹¤.   
í¬ë¡¬ì˜ *ê°œë°œìë„êµ¬ (F12)* ë¥¼ ì‚¬ìš©í•´ì„œ í•„ìš”í•œ ë¶€ë¶„ì„ í´ë¦­ í›„ *Copy selector* ë¡œ ê°€ì ¸ì˜¨ë‹¤.

![web1](images/2020-1/02.png)   
![web2](images/2020-1/03.png)   


### ì½”ë“œ   

í•´ë‹¹ í˜ì´ì§€ì˜ ê³µê³  ì¤‘ ì²« ë²ˆì§¸ì— ê²Œì‹œëœ ê¸€ì˜ ì œëª©ê³¼ ë§í¬ë¥¼ ê°€ì ¸ì˜¨ë‹¤.   
```python
html = requests.get('http://042.albamon.com/list/gi/mon_duty_list.asp?ps=50&ob=0&lvtype=1&rArea=,G000,&sDutyTerm=,5,10,20&rWDate=1&Empmnt_Type=')
html.encoding = 'euc-kr'
soup = BeautifulSoup(html.text, 'html.parser')
posts = soup.select('p.cTit > a')
link = posts[0].get('href')
latest = posts[0].text
```   
ì²« ë²ˆì§¸ ê²Œì‹œëœ ê³µê³ ì˜ ì œëª©ì´ *latest.txt* ì— ì €ì¥ì´ ë˜ê³ ,    
ê·¸ ì œëª©ì´ ê°™ì§€ ì•Šì„ ê²½ìš° ìƒˆë¡œìš´ ê³µê³ ì˜ ì œëª©ê³¼ ë§í¬ë¥¼ ë©”ì„¸ì§€ë¡œ ë³´ë‚´ì¤€ë‹¤.   
```python
with open(os.path.join(BASE_DIR, 'latest.txt'), 'r+') as f_read:
    before = f_read.readline()
    f_read.close()
    if before != latest:
        bot.sendMessage(chat_id=chat_id,text='<ë‹¨ê¸°ì•Œë°”ì•Œë¦¼!> '+latest+'\nâ–½ ì§€ì›í•˜ëŸ¬ê°€ê¸°'+'\nhttp://042.albamon.com'+link)
        with open(os.path.join(BASE_DIR, 'latest.txt'), 'w+') as f_write:
            f_write.write(latest)
            f_write.close()
```   
30ì´ˆë§ˆë‹¤ í™•ì¸í•˜ë„ë¡ ì„¤ì •í–ˆë‹¤.   
```python
sched = BlockingScheduler()
sched.add_job(job_function, 'interval', seconds=30)
sched.start()
```
### ë´‡ ì‹¤í–‰   
ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³¸ë‹¤!
  
```shell
python alba_crawler.py
```   
![chat](images/2020-1/04.png)   

## Review
ì–¼ë§ˆ ì „ì— ë°°ìš´ [movie_crawler](https://github.com/DeepxHyeon/movie_crawler)ë¥¼ í† ëŒ€ë¡œ ë‚´ê°€ ë¶ˆí¸í•¨ì„ ëŠê¼ˆë˜ ê³³ì— ë°”ë¡œ ì ìš©í•´ë³´ì•˜ë‹¤. ë°°í¬ê¹Œì§€ í•˜ê³  ì´í‹€ ë™ì•ˆ ì‚¬ìš©í•´ ë³¸ ê²°ê³¼ ì•„ì‰¬ìš´ ì ì´ ìˆë‹¤ë©´ íƒë°° ì•Œë°” ì•Œë¦¼ì´ ë§ì´ ì˜¨ë‹¤ëŠ” ê²ƒã… ã… ì´ ë¶€ë¶„ì€ ê°œì„ ì´ í•„ìš”í•˜ë‹¤. ê¸€ì„ ì“°ë©´ì„œ ì•½ê°„ì˜ ìˆ˜ê³ ê°€ ìˆì§€ë§Œ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…í•˜ëŠ” ì‹œê°„ë„ ì¶©ë¶„íˆ ì˜ë¯¸ ìˆëŠ” ì¼ì´ë¼ ìƒê°í•œë‹¤. ì˜í•˜ì!

## Reference   
[ì›¹í˜ì´ì§€ ì—…ë°ì´íŠ¸ë¥¼ ì•Œë ¤ì£¼ëŠ” Telegram ë´‡](https://beomi.github.io/gb-crawling/posts/2017-04-20-HowToMakeWebCrawler-Notice-with-Telegram.html)    
[íŒŒì´ì¬ìœ¼ë¡œ ì˜í™” ì˜ˆë§¤ ì˜¤í”ˆ ì•Œë¦¬ë¯¸ ë§Œë“¤ê¸°](https://www.inflearn.com/course/%EC%98%81%ED%99%94%EC%98%88%EB%A7%A4-%ED%8C%8C%EC%9D%B4%EC%8D%AC#)
